<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8">
	<title>知知大冒险</title>
	<style>
		body {
			font-family: "Segoe UI", sans-serif;
			margin: 0;
			background-image: url('firework.jpg');
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			background-attachment: fixed;
		}

		header {
			background: #11284D;
			color: #F4EFDF;
			padding: 20px;
			text-align: center;
		}

		nav {
			background: #101A2C;
			padding: 10px;
			display: flex;
			justify-content: center;
			gap: 20px;
			border-bottom: 1px solid #021024;
		}

		nav a {
			text-decoration: none;
			color: #F4EFDF;
			font-weight: bold;
		}

		.container {
			padding: 20px;
			max-width: 800px;
			margin: auto;
			background: #11284D;
			color: #F4EFDF;
		}

		.section {
			display: none;
		}

		.active {
			display: block;
		}

		textarea {
			width: 100%;
			height: 150px;
		}

		.photo-preview {
			max-width: 100%;
			margin-top: 10px;
		}
	</style>
</head>

<body>

	<header>
		<h1>知知大冒险</h1>
	</header>

	<nav>
		<a href="#" onclick="showSection('home')">主页</a>
		<a href="#" onclick="showSection('diary')">日记</a>
		<a href="#" onclick="showSection('photo')">照片</a>
	</nav>

	<div class="container">

		<!-- 主页 -->
		<div id="home" class="section active">
			<h2></h2>
			<p>"And miles to go before I sleehihihip"</p>
		</div>

		<!-- 日记 -->
		<div id="diary" class="section">
			<h2>写日记</h2>
			<textarea id="diaryText"></textarea>

			<h3>上传图片</h3>
			<input type="file" id="imageInput" accept="image/*">
			<img id="imagePreview" style="max-width: 200px; display:none; margin-top:10px;">

			<br><br>
			<button onclick="chooseFolder()">选择日记保存文件夹</button>
			<button onclick="saveDiary()">保存日记</button>

			<h3>日记列表</h3>
			<ul id="diaryList"></ul>
		</div>

		<!-- 照片上传 -->
		<div id="photo" class="section">
			<h2>上传照片</h2>
			<input type="file" accept="image/*" onchange="previewPhoto(event)">
			<img id="photoPreview" class="photo-preview">
		</div>

	</div>

	<script>
		// 切换页面
		function showSection(id) {
			document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
			document.getElementById(id).classList.add('active');
		}

		// 图片预览
		const imageInput = document.getElementById("imageInput");
		const imagePreview = document.getElementById("imagePreview");
		let currentImageData = null;

		imageInput.addEventListener("change", function () {
			const file = imageInput.files[0];
			if (!file) return;

			const reader = new FileReader();
			reader.onload = function (e) {
				currentImageData = e.target.result;
				imagePreview.src = currentImageData;
				imagePreview.style.display = "block";
			};
			reader.readAsDataURL(file);
		});

		// 选择文件夹
		async function chooseFolder() {
			const dirHandle = await window.showDirectoryPicker();
			window.diaryFolder = dirHandle;
			alert("已选择日记保存文件夹！");
		}

		// 保存成 TXT
		async function saveDiaryFile(text) {
			let content = text;

			// 附加图片
			if (currentImageData) {
				content += "\n\n[图片]\n" + currentImageData;
			}

			const name = `diary_${Date.now()}.txt`;
			const fileHandle = await diaryFolder.getFileHandle(name, { create: true });
			const writable = await fileHandle.createWritable();
			await writable.write(content);
			await writable.close();
		}

		// 保存日记（写入文件 + 显示网页）
		async function saveDiary() {
			const text = document.getElementById('diaryText').value;
			if (!text.trim()) return alert("日记内容不能为空");

			await saveDiaryFile(text);

			const list = document.getElementById('diaryList');
			const li = document.createElement('li');
			li.textContent = new Date().toLocaleString() + "： " + text;
			list.appendChild(li);

			document.getElementById('diaryText').value = "";
			currentImageData = null;
			imagePreview.style.display = "none";

			alert("日记已保存！");
		}

		// 另一个照片上传的预览
		function previewPhoto(e) {
			const file = e.target.files[0];
			document.getElementById('photoPreview').src = URL.createObjectURL(file);
		}
	</script>

</body>

</html>